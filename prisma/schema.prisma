// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(uuid())
  clerkUserId       String    @unique // Clerk's user ID
  email             String    @unique
  name              String?
  imageUrl          String?
  role              UserRole  @default(UNASSIGNED) // UNASSIGNED, CLIENT, CREATOR, ADMIN
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
 
  
  // Client-specific fields
  credits           Int       @default(2) // Accumulated credit balance
  
  // Creator-specific fields
  specialty         String? // e.g., Musician, Actor, Influencer
  portfolioUrls     String[]  // Links to media, reels, SoundCloud, YouTube
  experience        Int?      // Years of experience
  credentialUrl     String?   // Document URL
  description       String?   @db.Text
  verificationStatus VerificationStatus?  @default(PENDING)
  
  // Creator bank account info for product sales payouts
  bankAccountName   String?   // Account holder name
  bankAccountNumber String?   // Bank account number
  bankName          String?   // Bank name
  bankRoutingNumber String?   // Routing/Sort code
  bankCountry       String?   // Country code
  
  // Relations
  clientAppointments Appointment[] @relation("ClientAppointments")
  creatorAppointments  Appointment[] @relation("CreatorAppointments")
  availabilities      Availability[]
  transactions        CreditTransaction[]
  payouts             Payout[]
  skills              Skill[]   //
  portfolios         Portfolio[] 
  campaigns           Campaign[]
  campaignApplications CampaignApplication[]
  digitalProducts     DigitalProduct[]
  productSales        DigitalProductSale[] @relation("ProductBuyer")
  productPurchases    DigitalProductSale[] @relation("ProductSeller")
  mediaAgency         MediaAgency?
}

model Skill {
  id        String   @id @default(uuid())
  name      String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())
}

model Portfolio {
  id        String   @id @default(uuid())
  title     String? 
  description String? @db.Text
  url       String    // public URL from UploadThing (or S3/cloudinary)
  fileType  String?   // e.g. "image/png" or "video/mp4"
  fileKey   String?   // provider key (optional)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime  @default(now())
}

enum UserRole {
  UNASSIGNED
  CLIENT
  CREATOR
  ADMIN
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

model Availability {
  id        String   @id @default(uuid())
  creatorId  String
  creator    User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  startTime DateTime
  endTime   DateTime
  status    SlotStatus @default(AVAILABLE)
  
  @@index([creatorId, startTime])
}

enum SlotStatus {
  AVAILABLE
  BOOKED
  BLOCKED
}

model Appointment {
  id                String   @id @default(uuid())
  clientId         String
  client           User     @relation("ClientAppointments", fields: [clientId], references: [id])
  creatorId          String
  creator            User     @relation("CreatorAppointments", fields: [creatorId], references: [id])
  startTime         DateTime // Start time of appointment
  endTime           DateTime // End time of appointment
  status            AppointmentStatus @default(SCHEDULED)
  notes             String?  @db.Text
  clientDescription String? @db.Text
    
  // Video session fields
  videoSessionId    String?  // Vonage Video API Session ID
  videoSessionToken String?  // Optional: Can store tokens if needed
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([status, startTime])
  @@index([creatorId, startTime])
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

model CreditTransaction {
  id                String   @id @default(uuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amount            Int      // Positive for additions, negative for usage
  type              TransactionType
  packageId         String?  // Reference to which package was purchased
  createdAt         DateTime @default(now())
}

enum TransactionType {
  CREDIT_PURCHASE     // Credits purchased through Clerk Billing
  APPOINTMENT_DEDUCTION // Credit used for appointment
  ADMIN_ADJUSTMENT      // Manual adjustment by admin
}

model Payout {
  id              String        @id @default(uuid())
  creatorId        String
  creator          User          @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  amount          Float         // Total payout amount in USD
  credits         Int           // Number of credits being paid out
  platformFee     Float         // Platform fee deducted (2 USD per credit)
  netAmount       Float         // Amount creator receives (8 USD per credit)
  paypalEmail     String        // Creator's PayPal email for payout
  status          PayoutStatus  @default(PROCESSING)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  processedAt     DateTime?     // When admin marked it as processed
  processedBy     String?       // Admin who processed it

  @@index([status, createdAt])
  @@index([creatorId, status])
}

enum PayoutStatus {
  PROCESSING
  PROCESSED
}

model Campaign {
  id            String   @id @default(uuid())
  clientId      String   // Client who created the campaign
  client        User     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  title         String
  brand         String   // Brand/Company name
  description   String   @db.Text
  category      String   // e.g., "Digital Media", "TV Media", "Influencer Marketing"
  budgetMin     Float?   // Minimum budget
  budgetMax     Float?   // Maximum budget
  location      String   // e.g., "Accra", "Kumasi", "Nationwide"
  deadline      DateTime
  requirements  String[] // Array of requirement strings
  imageUrl      String?  // Campaign image URL
  status        CampaignStatus @default(DRAFT)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  applications  CampaignApplication[]
  
  @@index([status, createdAt])
  @@index([clientId])
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  CLOSED
  CANCELLED
}

model CampaignApplication {
  id            String   @id @default(uuid())
  campaignId    String
  campaign      Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  talentId      String   // Talent/Creator applying
  talent        User     @relation(fields: [talentId], references: [id], onDelete: Cascade)
  name          String
  email         String
  phone         String?
  location      String?
  portfolio     String?  @db.Text // Portfolio/social media links
  experience    String?  @db.Text // Relevant experience
  rate          Float?   // Expected compensation
  availability  String?  @db.Text
  additionalInfo String? @db.Text
  status        ApplicationStatus @default(PENDING)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([campaignId, talentId]) // Prevent duplicate applications
  @@index([campaignId, status])
  @@index([talentId])
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model DigitalProduct {
  id              String   @id @default(uuid())
  creatorId       String   // Creator who owns the product
  creator         User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  title           String
  description     String   @db.Text
  price           Float    // Price in USD
  category        String?  // e.g., "Music", "Video", "Course", "Template", "Art"
  imageUrl        String?  // Product thumbnail/cover image
  fileUrl         String?  // Digital file URL (protected)
  fileType        String?  // e.g., "mp3", "mp4", "pdf", "zip"
  downloadCount   Int      @default(0) // Number of times downloaded
  status          ProductStatus @default(DRAFT)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  sales           DigitalProductSale[]
  
  @@index([creatorId, status])
  @@index([status, createdAt])
}

enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

model DigitalProductSale {
  id                String   @id @default(uuid())
  productId         String
  product           DigitalProduct @relation(fields: [productId], references: [id], onDelete: Cascade)
  buyerId           String   // Client who purchased
  buyer             User     @relation("ProductBuyer", fields: [buyerId], references: [id], onDelete: Cascade)
  sellerId          String   // Creator who sold the product
  seller            User     @relation("ProductSeller", fields: [sellerId], references: [id], onDelete: Cascade)
  amount            Float    // Sale amount
  platformFee       Float    // Platform fee (1% of sale)
  creatorEarnings   Float    // Amount creator receives (99% of sale)
  status            SaleStatus @default(PENDING)
  downloadUrl       String?  // Temporary download URL
  downloadExpiresAt DateTime? // When download link expires
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([buyerId, createdAt])
  @@index([sellerId, createdAt])
  @@index([productId])
  @@index([status])
}

enum SaleStatus {
  PENDING
  COMPLETED
  REFUNDED
}

model MediaAgency {
  id                String   @id @default(uuid())
  userId            String?  @unique // Optional: linked to User account if authenticated
  user              User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  agencyName        String
  contactName       String
  email             String
  phone             String?
  website           String?
  address           String?
  city              String?
  region            String?
  country           String   @default("Ghana")
  description       String?  @db.Text
  logoUrl           String?  // Agency logo
  verificationStatus MediaAgencyStatus @default(PENDING)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  listings          MediaListing[]
  bookings          MediaBooking[]
  
  @@index([verificationStatus, createdAt])
}

enum MediaAgencyStatus {
  PENDING
  VERIFIED
  REJECTED
}

model MediaListing {
  id                String   @id @default(uuid())
  agencyId          String
  agency            MediaAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  listingType       MediaType // TV, Radio, Billboard, Digital, etc.
  name              String   // Station/Channel name (e.g., "Joy FM", "TV3")
  network           String?  // Network/Group name
  location          String   // City, Region
  frequency         String?  // For radio: "99.7 FM", for TV: "Channel 3"
  description       String?  @db.Text
  reach             String?  // e.g., "2M+ listeners", "5M+ households"
  demographics      String[] // Target demographics
  imageUrl          String?  // Station logo or image
  priceRange        String?  // e.g., "â‚µ250-1,500"
  timeSlots         String[] // Available time slots
  rating            Float?   @default(0) // Average rating
  status            ListingStatus @default(DRAFT)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  bookings          MediaBooking[]
  
  @@index([agencyId, status])
  @@index([listingType, status, location])
  @@index([status, createdAt])
}

enum MediaType {
  TV
  RADIO
  BILLBOARD
  DIGITAL
  INFLUENCER_MARKETING
  VIDEO_CLIPPING
}

enum ListingStatus {
  DRAFT
  ACTIVE
  INACTIVE
  ARCHIVED
}

model MediaBooking {
  id                String   @id @default(uuid())
  listingId         String
  listing           MediaListing @relation(fields: [listingId], references: [id], onDelete: Cascade)
  agencyId          String
  agency            MediaAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  clientName        String
  clientEmail       String
  clientPhone       String?
  packageName       String?  // Selected package name
  packagePrice      Float?
  startDate         DateTime?
  endDate           DateTime?
  duration          String?  // e.g., "30 seconds", "60 seconds"
  slots             Int?     // Number of spots/slots
  totalAmount       Float?
  status            BookingStatus @default(PENDING)
  notes             String?  @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([listingId, status])
  @@index([agencyId, status, createdAt])
  @@index([status, createdAt])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}